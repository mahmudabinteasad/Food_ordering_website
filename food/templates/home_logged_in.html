{% extends 'base_logged_in.html' %}
{% load static %}

{% block title %}Food Nest - Browse Restaurants{% endblock %}

{% block content %}
<!-- Search Bar -->
<div class="container my-4">
    <form class="form-inline d-flex justify-content-center" action="{% url 'search' %}" method="get">
        <input class="form-control me-2 shadow-sm" type="search" placeholder="Search by restaurant name or food item" aria-label="Search" name="q" style="width: 300px;">
        <button class="btn btn-outline-success" type="submit">Search</button>
    </form>
</div>

<!-- Featured Restaurants Section -->
<section class="bg-light py-5">
    <div class="container">
        <h2 class="text-center fw-semibold text-dark">ğŸ”¥ Featured Restaurants</h2>
        <p class="text-center text-muted mb-4">Don't miss today's best offers!</p>
        <div class="row">
            {% for deal in featured_restaurants %}
                <div class="col-md-3 mb-4">
                    <div class="card h-100 shadow-sm border-0">
                        {% if deal.image %}
                            <img src="{{ deal.image.url }}" class="card-img-top" alt="Featured Restaurant">
                        {% else %}
                            <img src="{% static 'images/featured.jpg' %}" class="card-img-top" alt="Featured Restaurant">
                        {% endif %}
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">{{ deal.name }}</h5>
                            <p class="card-text text-muted">{{ deal.address }}</p>
                            <a href="{% url 'menu' deal.restaurant_id %}" class="btn btn-danger btn-sm mt-auto">Order Now</a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Spacer -->
<div class="my-5"></div>

<!-- All Restaurants Section -->
<section>
    <div class="container">
        <h2 class="text-center fw-semibold text-dark mb-4">Explore Restaurants</h2>
        <div class="row" id="restaurant-list">
            {% for restaurant in restaurants_page %}
                <div class="col-md-4 mb-4">
                    <div class="card h-100 shadow-sm border-0">
                        {% if restaurant.image %}
                            <img src="{{ restaurant.image.url }}" class="card-img-top" alt="Restaurant Image">
                        {% else %}
                            <img src="{% static 'restaurant_images/steak2.jpg' %}" class="card-img-top" alt="Restaurant Image">
                        {% endif %}
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">{{ restaurant.name }}</h5>
                            <p class="card-text text-muted">{{ restaurant.address }}</p>
                            <a href="{% url 'menu' restaurant.restaurant_id %}" class="btn btn-primary mt-auto">View Menu</a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>

        <!-- Load More Button -->
        <div class="text-center mt-4">
            {% if restaurants_page.has_next %}
                <button class="btn btn-outline-primary" id="load-more-btn" data-page="{{ restaurants_page.next_page_number }}">Load More</button>
            {% endif %}
        </div>
    </div>
</section>

<!-- JavaScript to Handle Load More Button -->
<script>
document.getElementById('load-more-btn')?.addEventListener('click', function () {
    const button = this;
    const page = button.getAttribute('data-page');

    fetch(`?page=${page}`)
        .then(response => response.text())
        .then(html => {
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const newRestaurants = doc.querySelectorAll('#restaurant-list .col-md-4');
            const loadMoreButton = doc.getElementById('load-more-btn');

            newRestaurants.forEach(restaurant => {
                document.getElementById('restaurant-list').appendChild(restaurant);
            });

            if (loadMoreButton) {
                button.setAttribute('data-page', loadMoreButton.getAttribute('data-page'));
            } else {
                button.style.display = 'none';
            }
        })
        .catch(error => console.error('Error loading more restaurants:', error));
});
</script>
{% endblock %}
